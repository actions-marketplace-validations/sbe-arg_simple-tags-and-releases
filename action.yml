name: 'Simple tags and releases'
description: 'Simple tag and release process for your repos'
inputs:
  autogenerated_notes:
    description: 'Specify if release notes should be autogenerated'
    required: false
    default: 'true'
  version_file:
    description: 'Path to file'
    required: false
    default: 'VERSION'
runs:
  using: composite
  steps:
    - name: tag and create release
      id: bump_version
      shell: bash
      run: |
        version=$(cat $version_file)
        autogenerated_notes=${{ inputs.autogenerated_notes }}

        # If the tag exists for that version, do nothing
        if git rev-parse "$version" >/dev/null 2>&1; then
          echo "Tag $version already exists."
          exit 0
        fi

        # Create and push the new tag
        git tag "$version"
        git push -f origin "$version"

        # Create a release from the tag
        if [[ $autogenerated_notes == "true" ]]; then
          gh release create --title "Release $version" --notes "" --tag "$version" --notes-stdin <<EOF
        Autogenerated release notes
        EOF
        else
          gh release create --title "Release $version" --notes "Edit release notes" --tag "$version"
        fi